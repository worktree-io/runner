#!/bin/sh

echo "Running cargo buildâ€¦"
if ! cargo build 2>&1; then
    echo "Push blocked: cargo build failed. Fix the build errors before pushing."
    exit 1
fi

MAX_LINES=100
FAILED=0

for file in $(find src -name "*.rs"); do
    count=$(wc -l < "$file")
    if [ "$count" -gt "$MAX_LINES" ]; then
        echo "error: $file has $count lines (limit is $MAX_LINES)"
        FAILED=1
    fi
done

if [ "$FAILED" -ne 0 ]; then
    echo "Push blocked: one or more source files exceed the $MAX_LINES line limit."
    exit 1
fi
