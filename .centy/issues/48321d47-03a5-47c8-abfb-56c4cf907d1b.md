---
displayNumber: 5
status: open
priority: 2
createdAt: 2026-02-21T21:03:42.781849+00:00
updatedAt: 2026-02-21T21:03:42.781849+00:00
---

# Support on-open bash script hook with Mustache templating

## Motivation

Users often need to run setup steps when a workspace is first opened — installing
dependencies, configuring git credentials, posting a Slack notification, etc. The
runner should allow an optional shell script to run when `worktree open` is
invoked, defined in the user's config file.

## Proposed config shape

```toml
[hooks]
on_open = """
#!/usr/bin/env bash
set -euo pipefail

echo "Setting up {{owner}}/{{repo}}#{{issue}}"
cd {{worktree_path}}
npm install
"""
```

## Mustache context variables

All of these are available at open time:

| Variable | Description |
| --- | --- |
| `{{owner}}` | GitHub owner / org (e.g. `acme`) |
| `{{repo}}` | Repository name (e.g. `api`) |
| `{{issue}}` | Issue number (e.g. `42`) |
| `{{branch}}` | Branch name (e.g. `issue-42`) |
| `{{worktree_path}}` | Absolute path to the worktree directory |

## Implementation sketch

1. Add `HooksConfig` struct to `config.rs`:
   ```rust
   pub struct HooksConfig {
       pub on_open: Option<String>,
   }
   ```
   and extend `Config` with a `hooks: HooksConfig` field (TOML section `[hooks]`).

2. After the workspace is created (but before or after launching the editor),
   render the script via the `mustache` crate (or `tinytemplate`) with the
   workspace context.

3. Write the rendered script to a temp file, `chmod +x`, and execute it via
   `sh -c` (or the user's `$SHELL`) — wait for it to exit before continuing.

4. Forward stdout/stderr so the user can see script output.

5. If the script exits non-zero, print a warning but still open the editor
   (or add a `hooks.on_open_fail = "abort" | "warn"` option in a follow-up).

## Open questions

- Should the script run before or after the editor launches? (Before seems safer.)
- Should we add a timeout option?
- Should the script path be supported as an alternative to inline content?
  e.g. `on_open_script = "~/.config/worktree/on_open.sh"`
