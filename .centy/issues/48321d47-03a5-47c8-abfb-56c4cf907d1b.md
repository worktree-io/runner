---
displayNumber: 5
status: open
priority: 2
createdAt: 2026-02-21T21:03:42.781849+00:00
updatedAt: 2026-02-21T21:03:42.781849+00:00
---

# Support pre:open and post:open bash script hooks with Mustache templating

## Motivation

Users often need to run setup steps when a workspace is first opened — installing
dependencies, configuring git credentials, posting a Slack notification, etc. The
runner should allow optional shell scripts to run when `worktree open` is
invoked, defined in the user's config file.

Two hooks are supported:

- `pre:open` — runs after the worktree is created but **before** the editor launches
- `post:open` — runs **after** the editor launches

## Proposed config shape

```toml
[hooks]
pre:open = """
#!/usr/bin/env bash
set -euo pipefail

echo "Setting up {{owner}}/{{repo}}#{{issue}}"
cd {{worktree_path}}
npm install
"""

post:open = """
#!/usr/bin/env bash
curl -s https://hooks.example.com/notify \
  --data "repo={{repo}}&branch={{branch}}"
"""
```

## Mustache context variables

All of these are available at open time:

| Variable | Description |
| --- | --- |
| `{{owner}}` | GitHub owner / org (e.g. `acme`) |
| `{{repo}}` | Repository name (e.g. `api`) |
| `{{issue}}` | Issue number (e.g. `42`) |
| `{{branch}}` | Branch name (e.g. `issue-42`) |
| `{{worktree_path}}` | Absolute path to the worktree directory |

## Implementation sketch

1. Add `HooksConfig` struct to `config.rs`:
   ```rust
   pub struct HooksConfig {
       pub pre_open: Option<String>,
       pub post_open: Option<String>,
   }
   ```
   and extend `Config` with a `hooks: HooksConfig` field (TOML section `[hooks]`).
   Map TOML keys `pre:open` / `post:open` to the struct fields via `#[serde(rename)]`.

2. In `cmd_open`, after the worktree is created:
   - Run `pre_open` (if set), wait for exit, then launch the editor.
   - Run `post_open` (if set) after the editor process starts.

3. For each hook: render the script via the `mustache` crate (or `tinytemplate`)
   with the workspace context, write to a temp file, `chmod +x`, and execute via
   `sh -c` (or the user's `$SHELL`).

4. Forward stdout/stderr so the user can see script output.

5. If either script exits non-zero, print a warning but continue
   (or add a `hooks.on_fail = "abort" | "warn"` option in a follow-up).

## Open questions

- Should we add a timeout option?
- Should the script path be supported as an alternative to inline content?
  e.g. `pre:open = { script = "~/.config/worktree/pre_open.sh" }`
